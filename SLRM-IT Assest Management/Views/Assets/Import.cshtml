@{
    ViewData["Title"] = "Import Data";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="content">
    <div class="header">
        <h2>Import</h2>
        <div class="user-info">
            <img src="https://ui-avatars.com/api/?name=Basavangj&background=3498db&color=fff" alt="User">
            <div>
                <div style="font-size: 12px; color: var(--text-light);">Admin</div>
            </div>
        </div>
    </div>

    <form asp-action="Import" asp-controller="Assets" method="post" enctype="multipart/form-data" id="importForm">
        @Html.AntiForgeryToken()
        <input type="file" id="fileInput" name="file" style="display:none;" accept=".xlsx,.xls,.csv,.json,.xml,.txt" />

        <div class="card" style="max-width: 900px; margin: 0 auto;">
            <div class="card-header">
                <h3 style="margin: 0;">Import Data</h3>
            </div>
            <div style="padding: 20px;">
                <!-- Import Description -->
                <div style="margin-bottom: 30px;">
                    <h4 style="color: var(--accent); margin-bottom: 10px;">
                        <i class="fas fa-info-circle"></i> Importing
                    </h4>
                    <p style="color: var(--text-light); line-height: 1.6;">
                        You can import assets, accessories, licenses, components, consumables, and users via various file formats.<br>
                        Supported formats: <strong>XLSX, CSV, JSON, XML, TXT</strong>
                    </p>
                </div>

                <!-- Import Type Selection -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">
                        <i class="fas fa-database"></i> Import Type
                    </label>
                    <select id="importType" name="importType" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: white;" required>
                        <option value="">-- Select what you want to import --</option>
                        <option value="assets">Assets</option>
                        <option value="accessories">Accessories</option>
                        <option value="licenses">Licenses</option>
                        <option value="components">Components</option>
                        <option value="consumables">Consumables</option>
                        <option value="users">Users</option>
                        <option value="kits">Predefined Kits</option>
                    </select>
                </div>

                <!-- File Upload Area -->
                <div id="dropArea" style="border: 2px dashed #ddd; border-radius: 8px; padding: 40px; text-align: center; margin-bottom: 30px; background: #fafafa; position: relative;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                    <h4 style="margin-bottom: 10px; color: var(--text-light);">Drag files here to add them to your repository</h4>
                    <p style="color: var(--text-light); margin-bottom: 20px;">
                        Supported formats: XLSX, CSV, JSON, XML, TXT<br>
                        Max file size: 100MB
                    </p>
                    <button type="button" onclick="document.getElementById('fileInput').click()"
                            style="background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
                        <i class="fas fa-folder-open"></i> Choose Files
                    </button>
                </div>

                <!-- Selected Files Table -->
                <div id="selectedFiles" style="display: none; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px; color: var(--accent);">
                        <i class="fas fa-file"></i> Selected Files
                    </h4>
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">File Name</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Type</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Size</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Action</th>
                            </tr>
                        </thead>
                        <tbody id="fileTableBody"></tbody>
                    </table>
                </div>

                <!-- Import Options -->
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: var(--accent);">
                        <i class="fas fa-cog"></i> Import Options
                    </h4>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="overwriteExisting" name="overwriteExisting" checked>
                        <span>Overwrite existing records</span>
                    </label>
                </div>

                <!-- Commit Section -->
                <div style="margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 4px;">
                    <h4 style="margin-bottom: 15px; color: var(--accent);">
                        <i class="fas fa-upload"></i> Import Settings
                    </h4>
                    <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                        <input type="text" name="commitMessage" placeholder="Add files via upload"
                               style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <button type="submit" id="importButton" style="background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-upload"></i> Import Now
                        </button>
                    </div>
                    <textarea name="importDescription" placeholder="Add an optional extended description..."
                              style="width: 100%; height: 80px; margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"></textarea>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        const fileInput = document.getElementById('fileInput');
        const fileTableBody = document.getElementById('fileTableBody');
        const selectedFilesDiv = document.getElementById('selectedFiles');
        const dropArea = document.getElementById('dropArea');
        const importForm = document.getElementById('importForm');
        const importTypeSelect = document.getElementById('importType');

        // Handle file input preview
        fileInput.addEventListener('change', e => handleFiles(e.target.files));
        function handleFiles(files) {
            fileTableBody.innerHTML = '';
            for (let file of files) {
                const fileExt = file.name.split('.').pop().toLowerCase();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding: 12px; border-bottom: 1px solid #ddd;">${file.name}</td>
                    <td style="padding: 12px; border-bottom: 1px solid #ddd;">${fileExt.toUpperCase()}</td>
                    <td style="padding: 12px; border-bottom: 1px solid #ddd;">${formatFileSize(file.size)}</td>
                    <td style="padding: 12px; border-bottom: 1px solid #ddd;">
                        <button type="button" onclick="removeFile(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px;">Remove</button>
                    </td>
                `;
                fileTableBody.appendChild(row);
            }
            selectedFilesDiv.style.display = files.length ? 'block' : 'none';
        }

        function removeFile(button) {
            button.closest('tr').remove();
            if (fileTableBody.children.length === 0) selectedFilesDiv.style.display = 'none';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Drag & Drop styling
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); }, false);
        });
        ['dragenter', 'dragover'].forEach(eventName => dropArea.addEventListener(eventName, () => dropArea.style.backgroundColor = '#f0f8ff'));
        ['dragleave', 'drop'].forEach(eventName => dropArea.addEventListener(eventName, () => dropArea.style.backgroundColor = '#fafafa'));
        dropArea.addEventListener('drop', e => {
            const files = e.dataTransfer.files;
            handleFiles(files);
            fileInput.files = files;
        });

        // Dynamically update form action based on selection
        importForm.addEventListener('submit', function (e) {
            const selected = importTypeSelect.value;

            switch (selected) {
                case "licenses":
                    importForm.action = "/Licenses/Import1";
                    break;
                case "assets":
                    importForm.action = "/Assets/Import";
                    break;
                case "accessories":
                    importForm.action = "/Accessories/Import";
                    break;
                case "components":
                    importForm.action = "/Components/Import";
                    break;
                case "consumables":
                    importForm.action = "/Consumables/Import";
                    break;
                case "users":
                    importForm.action = "/Users/Import";
                    break;
                case "kits":
                    importForm.action = "/Kits/Import";
                    break;
                default:
                    alert("Please select a valid import type.");
                    e.preventDefault();
                    break;
            }
        });
    </script>
}

}
